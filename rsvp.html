<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rsvp - inkys party</title>
    <link rel="stylesheet" href="style.css"/>
    <link rel="icon" type="image/x-icon" href="cat4.png">
</head>
<script>
    let catPosition = -100;
    let catSpeed = 5;
    let catInterval;
    
    function moveCat() {
        var cat = document.getElementById('cat');
        var width = window.innerWidth;
        cat.style.marginLeft = catPosition + 'px';
        catPosition += catSpeed;
        
        // Speed up much faster over time
        catSpeed += 0.15;
        
        if (catPosition > width + 100) {
            cat.style.marginLeft = '-100px';
            catPosition = -100;
            // Reset speed but keep it much faster than before
            catSpeed = Math.min(catSpeed * 0.9, 100); // Cap at 100 for max chaos
        }
    }
    
    addEventListener('load', function(){
        catInterval = setInterval(moveCat, 35);
        
        // Make cat clickable
        document.getElementById('cat').addEventListener('click', function() {
            window.open('https://www.youtube.com/watch?v=hp_4Ex4mVWE', '_blank');
        });
    });

    async function submitRSVP(event) {
        event.preventDefault();
        
        const form = event.target;
        const submitBtn = form.querySelector('button[type="submit"]');
        const statusDiv = document.getElementById('status');
        
        // Get all checked dates
        const checkedDates = Array.from(form.querySelectorAll('.date-checkbox:checked'))
            .map(checkbox => checkbox.value);
        
        // Validate at least one date is selected
        if (checkedDates.length === 0) {
            statusDiv.className = 'status error';
            statusDiv.textContent = '‚úó please select at least one date option';
            return;
        }
        
        // Get form data
        const formData = {
            name: form.name.value,
            dates: checkedDates, // Changed from 'date' to 'dates' array
            format: form.format.value,
            dietary: form.dietary.value,
            comments: form.comments.value,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
        };
        
        // Disable submit button
        submitBtn.disabled = true;
        submitBtn.textContent = 'submitting...';
        statusDiv.textContent = '';
        
        try {
            // Submit to Cloudflare Pages Function
            const response = await fetch('/api/rsvp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úì your rsvp has been submitted! thank you~';
                form.reset();
                
                // Show success message for a bit
                setTimeout(() => {
                    statusDiv.textContent = '';
                }, 5000);
            } else {
                throw new Error(result.error || 'Submission failed');
            }
        } catch (error) {
            console.error('RSVP submission error:', error);
            statusDiv.className = 'status error';
            statusDiv.textContent = '‚úó oops! something went wrong. please try again or text inky directly.';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'submit rsvp';
        }
    }
</script>
<body>
    <div class="sidebar">
        <a href="index.html#welcome" class='tab-title'>hi</a>
        <a href="index.html#menu" class='tab-title'>menu</a>
        <a href="index.html#general" class='tab-title'>general information</a>
        <a href="rsvp.html" class='tab-title'>rsvp</a>
        <a href="index.html#thanks" class='tab-title'>thanks</a>
    </div>
    <img class="background" src="cat4.png" alt="Background">
    
    <div class="content">
        <div class="rsvp-container">
            <h1>rsvp for inkys party</h1>
            
            <div class="cat-separator">
                <span>üê± ~ ~ ~ üê±</span>
            </div>
            
            <p class="intro-text">
                help inky plan the purrfect party! let us know your preferences below~
            </p>
            
            <form onsubmit="submitRSVP(event)" class="rsvp-form">
                <div class="form-group">
                    <label for="name">your name *</label>
                    <input type="text" id="name" name="name" required placeholder="ex: whiskers">
                </div>
                
                <div class="form-group">
                    <label>which dates work for you? (select all that apply) *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="checkbox" name="date" value="dec31" class="date-checkbox">
                            <span>december 31 (new year's eve)</span>
                        </label>
                        <label class="radio-label">
                            <input type="checkbox" name="date" value="jan2" class="date-checkbox">
                            <span>january 2</span>
                        </label>
                        <label class="radio-label">
                            <input type="checkbox" name="date" value="jan3" class="date-checkbox">
                            <span>january 3</span>
                        </label>
                        <label class="radio-label">
                            <input type="checkbox" name="date" value="none" class="date-checkbox">
                            <span>i can't make any of these dates üòø</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>what type of party sounds better? *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="format" value="dinner" required>
                            <span>intimate dinner party (inky cooks a set menu)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="format" value="house" required>
                            <span>larger house party (more people, casual vibes)</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="dietary">dietary restrictions / allergies</label>
                    <input type="text" id="dietary" name="dietary" placeholder="ex: vegetarian, allergic to fish">
                </div>
                
                <div class="form-group">
                    <label for="comments">any other thoughts?</label>
                    <textarea id="comments" name="comments" rows="3" placeholder="suggestions, song requests, anything~"></textarea>
                </div>
                
                <div id="status" class="status"></div>
                
                <button type="submit" class="submit-btn">submit rsvp</button>
            </form>
            
            <div class="cat-separator">
                <span>üê± ~ ~ ~ üê±</span>
            </div>
            
            <p class="footer-note">
                * responses are private and only visible to inky<br>
                beware: the cat may try to escape while you're here
            </p>
        </div>
    </div>
    
    <div id="cat" style="cursor: pointer;">
        <span>    \&nbsp;&nbsp;&nbsp;&nbsp;/\ </span><br>
        <span>    &nbsp;)&nbsp;&nbsp;(&nbsp;')</span><br>
        <span>   (&nbsp;&nbsp;/&nbsp;&nbsp;)</span><br>
        <span>   &nbsp;\(__)|</span> <br>
    </div>
</body>
</html>
